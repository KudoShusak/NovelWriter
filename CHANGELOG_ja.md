# 変更履歴

このプロジェクトへの重要な変更はすべてこのファイルに記録されます。

## v0.00.2 - 2025-12-28

### 追加 (手動編集サポート)
- **再構築コマンド (`reconstruct`)**:
    - CLIコマンドを追加しました (`python main.py reconstruct --scene N`)。
    - シーンテキストに基づいて、シーンNまでの `state.json` (状態履歴) を再構築します。
    - 現在のテキストに基づいてシーンNの要約を再生成します。
    - 手動でシーンファイルを修正した後、整合性を保って執筆を再開するのに役立ちます。
- **状態スナップショット**:
    - 各シーンの執筆・再構築後に `state_{n}.json` を自動保存するようにしました。
    - 再構築時に最新の有効なスナップショットを読み込み、処理を高速化するロジックを実装しました。

### 追加 (品質改善)
- **文体の設定機能**:
    - `config.py` に `NOVEL_STYLE` を追加し、小説全体のトーン（例：「ラノベ調」「純文学風」）を設定可能にしました。
    - 執筆プロンプトが設定されたスタイルに従うように更新しました。

## v0.00.1 - 2025-12-19

### 追加 (品質改善)
- **状態管理システム**:
    - `state.json` を実装し、キャラクターの場所、状態、所持品、および累積経験ログをシーン間で追跡するようにしました。
    - 各シーンの執筆後に世界の状態を動的に更新する `update_state` メソッドを追加しました。
- **キャラクターの一貫性強化**:
    - `characters.json` のスキーマを拡張し、`first_person`（一人称）、`second_person`（二人称）、`speech_examples`（セリフ例）を追加しました。
    - プロファイルで定義されたキャラクターの口調や振る舞いを厳守するよう、執筆プロンプトを更新しました。
- **地の文の視点統一**:
    - `config.py` に `NOVEL_VIEWPOINT` 設定を追加しました（デフォルト：「三人称神視点」）。
    - シーン内で意図せず視点が切り替わるのを防ぐため、プロンプトを更新しました。
- **徹底的なキャラクター抽出**:
    - 回想や言及のみで登場する人物（例：「父」「かつての師」）であっても、すべての関連人物に名前を創作して割り当てるよう、キャラクター生成ロジックを更新しました。
- **シーンタイトルの自動生成**:
    - シーン執筆後に魅力的なタイトルを自動生成し、Markdownファイルの先頭に追加する機能を追加しました。

### 変更
- **プロジェクト構成**:
    - ルートディレクトリをクリーンに保つため、生成ファイル（`drafts/`、`characters.json`、`plot.md` 等）を `writing/` サブディレクトリに保存するようにしました。（`config.py` で設定）
- **プロンプト**:
    - 日本語出力の品質を高め、厳格なフォーマットルールに従うよう、`generators.py` 内のすべてのプロンプトを改善しました。
